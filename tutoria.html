<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tutoría</title>
        <!-- Enlace al archivo CSS de Bootstrap desde un CDN -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Enlace al archivo CSS externo -->
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="container-fluid d-flex p-0">
            <!-- Menú lateral -->
            <div class="MenuLateral bg-light p-4 d-flex flex-column vh-100">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link text-dark" href="inicio.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="mentoring.html">Mentoring</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="emprendimiento.html">Emprendimiento</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="competenciasDigitales.html">Competencias digitales</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="tutoria.html">Tutorías</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="mensajeria.html">Mensajes</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="perfil.html">Perfil</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="acceso.html">Cerrar sesión</a></li>
                </ul>
            </div>

            <!-- Contenido principal -->
            <div class="content flex-grow-1 p-4">
                    <header class="d-flex justify-content-between align-items-center mb-3">
                        <h1 class="h3">Tutoría</h1>
                        <button onclick="abrirTutoria()" class="btn btn-warning">Nueva tutoria</button>
                    </header>
                    
                <!-- Ventana de crear la tutoria -->
                <div id="tutoria" class="position-fixed top-50 start-50 translate-middle bg-white p-4 rounded shadow d-none">
                    <form onsubmit="return enviarTutoria()">
                        <!-- Título y botón para cerrar arriba -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3>Nueva tutoría</h3>
                            <span onclick="cerrarTutoria()" class="text-danger fw-bold" style="cursor: pointer;">[X]</span>
                        </div>

                        <!-- Campos del formulario -->
                        <input type="text" id="alumno" placeholder="Tutoría con:" class="form-control my-2" required><br>
                        <textarea id="tema" placeholder="Tema:" class="form-control my-2" required></textarea><br>
                        <input type="datetime-local" id="fecha" class="form-control my-2" required>

                        <!-- Botón de envío -->
                        <button type="submit" class="btn btn-warning w-100">Enviar</button>
                    </form>
                </div>

                    
                    <!-- Lista de Tutorias -->
                    <div id="listaTutorias" class="mt-3"></div>
                    </div>
            </div>
        </div>
            <script>
                function resetFecha(){
                    const ahora = new Date()
                    // Ajustar la hora a la zona horaria local (sin UTC)
                    const anio = ahora.getFullYear();
                    const mes = String(ahora.getMonth() + 1).padStart(2, '0');//Solo dos digitos
                    const dia = String(ahora.getDate()).padStart(2, '0');
                    const hora = String(ahora.getHours()).padStart(2, '0');
                    const minutos = String(ahora.getMinutes()).padStart(2, '0');
                    
                    // Formatear la fecha y hora locales en el formato requerido para el input datetime-local
                    const fechaLocal = `${anio}-${mes}-${dia}T${hora}:${minutos}`;
                    document.getElementById("fecha").value = fechaLocal;
                    document.getElementById("fecha").min = fechaLocal;  // Establecer el valor mínimo como la fecha y hora actuales
                    document.getElementById("fecha").value = fechaLocal;
                    document.getElementById("fecha").min= fechaLocal;
                }
                
                function abrirTutoria() {
                    document.getElementById("tutoria").classList.remove("d-none");
                }

                function cerrarTutoria() {
                    document.getElementById("tutoria").classList.add("d-none");
                }
                
                function enviarTutoria() {
                    const alumno = document.getElementById("alumno").value;
                    const tema = document.getElementById("tema").value;
                    const fecha = document.getElementById("fecha").value;
                    
                    if (!alumno || !tema || !fecha) {
                        alert("Por favor, completa todos los campos.");
                        return false;
                    }
                    
                    const listaTutorias = document.getElementById("listaTutorias");
                    
                    const ahora = new Date();
                    const fechaHoraFormateada = ahora.toLocaleString("es-ES", {
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    // Formatear la fecha programada para mostrarla como 2025-03-19 / 11:05
                    const fechaProgramada = new Date(fecha);
                    const fechaProgramadaFormateada = fechaProgramada.toLocaleString("es-ES", {
                    dateStyle: "short",
                    timeStyle: "short"
                });
                            // Crear la nueva Tutoria
                const nuevaTutoria = document.createElement("article");
                nuevaTutoria.innerHTML = `
                <div class="d-flex flex-column border-bottom pb-2 bg-light p-3 rounded shadow mb-3">
                    <!-- Fila superior -->
                    <div class="d-flex justify-content-between w-100 mb-2">
                        <div><strong>Alumno:</strong> ${alumno}</div>
                        <div class="text-end"><small class="text-muted">${fechaHoraFormateada}</small></div>
                    </div>
                    <!-- Fila inferior -->
                    <div class="d-flex justify-content-between">
                        <div><strong>Tema:</strong> ${tema}</div>
                        <div><strong>Fecha Programada:</strong> ${fechaProgramadaFormateada}</div>
                    </div>
                </div>
                `;
                
                // Añadir el Tutoria al principio de la lista
                listaTutorias.prepend(nuevaTutoria);
                
                // Limpiar campos
                document.getElementById("alumno").value = "";
                document.getElementById("tema").value = "";
                resetFecha();
                
                // Cerrar la ventana
                cerrarTutoria();
                
                return false; // Evitar recarga de la página
                
            }
            // Llamar a resetFecha al cargar la página para mostrar la fecha y hora actuales
            window.onload = resetFecha;
        </script>
    </body>
</html>
